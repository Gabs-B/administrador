<div class="reclamos-container">
    <!-- Header -->
    <div class="reclamos-header">
        <h1 class="titulo">Gesti√≥n de Reclamos y Quejas</h1>
    </div>

    <!-- Estad√≠sticas -->
    <div class="estadisticas-section" *ngIf="estadisticas">
        <div class="estadisticas-grid">
            <div class="estadistica-card total">
                <div class="estadistica-info">
                    <span class="estadistica-numero">{{ estadisticas.total }}</span>
                    <span class="estadistica-label">Total</span>
                </div>
            </div>
            <div class="estadistica-card pendientes">
                <div class="estadistica-info">
                    <span class="estadistica-numero">{{ estadisticas.pendientes }}</span>
                    <span class="estadistica-label">Pendientes</span>
                </div>
            </div>
            <div class="estadistica-card proceso">
                <div class="estadistica-info">
                    <span class="estadistica-numero">{{ estadisticas.en_proceso }}</span>
                    <span class="estadistica-label">En Proceso</span>
                </div>
            </div>
            <div class="estadistica-card resueltas">
                <div class="estadistica-info">
                    <span class="estadistica-numero">{{ estadisticas.resueltas }}</span>
                    <span class="estadistica-label">Resueltas</span>
                </div>
            </div>
            <div class="estadistica-card reclamos">
                <div class="estadistica-info">
                    <span class="estadistica-numero">{{ estadisticas.reclamos }}</span>
                    <span class="estadistica-label">Reclamos</span>
                </div>
            </div>
            <div class="estadistica-card quejas">
                <div class="estadistica-info">
                    <span class="estadistica-numero">{{ estadisticas.quejas }}</span>
                    <span class="estadistica-label">Quejas</span>
                </div>
            </div>
        </div>
    </div>

    <!-- Filtros -->
    <div class="filtros-section">
        <div class="filtros-grid">
            <!-- B√∫squeda -->
            <div class="filtro-grupo">
                <label class="filtro-label">Buscar:</label>
                <input
                    type="text"
                    class="filtro-input"
                    placeholder="N√∫mero de reclamo, DNI, nombre o email..."
                    [(ngModel)]="filtros.buscar"
                    (keyup.enter)="aplicarFiltros()"
                />
            </div>

            <!-- Estado -->
            <div class="filtro-grupo">
                <label class="filtro-label">Estado:</label>
                <select class="filtro-select" [(ngModel)]="filtros.estado">
                    <option *ngFor="let opcion of estadosOptions" [value]="opcion.value">
                        {{ opcion.label }}
                    </option>
                </select>
            </div>

            <!-- Tipo de reclamo -->
            <div class="filtro-grupo">
                <label class="filtro-label">Tipo:</label>
                <select class="filtro-select" [(ngModel)]="filtros.tipo_reclamo">
                    <option *ngFor="let opcion of tiposReclamoOptions" [value]="opcion.value">
                        {{ opcion.label }}
                    </option>
                </select>
            </div>

            <!-- Fecha desde -->
            <div class="filtro-grupo">
                <label class="filtro-label">Desde:</label>
                <input
                    type="date"
                    class="filtro-input"
                    [(ngModel)]="filtros.fecha_desde"
                />
            </div>

            <!-- Fecha hasta -->
            <div class="filtro-grupo">
                <label class="filtro-label">Hasta:</label>
                <input
                    type="date"
                    class="filtro-input"
                    [(ngModel)]="filtros.fecha_hasta"
                />
            </div>

            <!-- Botones de filtro -->
            <div class="filtro-acciones">
                <button class="btn btn-primary" (click)="aplicarFiltros()" [disabled]="cargando">
                    <span *ngIf="!cargando">Buscar</span>
                    <span *ngIf="cargando">Cargando...</span>
                </button>
                <button class="btn btn-outline" (click)="limpiarFiltros()" [disabled]="cargando">
                    Limpiar
                </button>
            </div>
        </div>
    </div>

    <!-- Loading -->
    <div *ngIf="cargando" class="loading-container">
        <div class="loading-spinner"></div>
        <span>Cargando reclamos...</span>
    </div>

    <!-- Error -->
    <div *ngIf="error && !cargando" class="error-container">
        <div class="error-message">
            <span class="error-icon">‚ö†Ô∏è</span>
            {{ error }}
        </div>
        <button class="btn btn-secondary" (click)="cargarReclamos()">
            Reintentar
        </button>
    </div>

    <!-- Tabla de reclamos -->
    <div *ngIf="!cargando && !error" class="tabla-container">
        <!-- Info de resultados -->
        <div class="resultados-info" *ngIf="paginacion">
            <span>
                Mostrando {{ paginacion.from }} - {{ paginacion.to }} de {{ paginacion.total }} reclamos
            </span>
            <div class="paginacion-info">
                P√°gina {{ paginacion.current_page }} de {{ paginacion.last_page }}
            </div>
        </div>

        <!-- Tabla -->
        <div class="tabla-wrapper">
            <table class="reclamos-tabla">
                <thead>
                    <tr>
                        <th>N¬∞ Reclamo</th>
                        <th>Cliente</th>
                        <th>Documento</th>
                        <th>Tipo</th>
                        <th>Estado</th>
                        <th>Fecha</th>
                        <th class="acciones-header">Acciones</th>
                    </tr>
                </thead>
                <tbody>
                    <tr *ngFor="let reclamo of reclamos" class="reclamo-row">
                        <!-- N√∫mero de reclamo -->
                        <td class="numero-cell">
                            <span class="numero-reclamo">{{ reclamo.numero_reclamo }}</span>
                        </td>

                        <!-- Cliente -->
                        <td class="cliente-cell">
                            <div class="cliente-info">
                                <span class="cliente-nombre">{{ getNombreCompleto(reclamo) }}</span>
                                <span class="cliente-email" *ngIf="reclamo.email">{{ reclamo.email }}</span>
                            </div>
                        </td>

                        <!-- Documento -->
                        <td class="documento-cell">
                            <span class="documento-numero">{{ reclamo.numero_documento }}</span>
                        </td>

                        <!-- Tipo -->
                        <td class="tipo-cell">
                            <span 
                                class="tipo-badge"
                                [class]="getTipoClase(reclamo.tipo_reclamo)"
                            >
                                {{ reclamo.tipo_reclamo | titlecase }}
                            </span>
                        </td>

                        <!-- Estado (ahora solo lectura) -->
                        <td class="estado-cell">
                            <span 
                                class="estado-badge"
                                [class]="getEstadoClase(reclamo.estado)"
                            >
                                {{ reclamo.estado === 'en_proceso' ? 'En Proceso' : (reclamo.estado | titlecase) }}
                            </span>
                        </td>

                        <!-- Fecha -->
                        <td class="fecha-cell">
                            <span class="fecha-text">
                                {{ formatearFecha(reclamo.created_at) }}
                            </span>
                        </td>

                        <!-- Acciones -->
                        <td class="acciones-cell">
                            <button 
                                class="btn btn-sm btn-outline"
                                (click)="verDetalle(reclamo)"
                                title="Ver detalle"
                            >
                                <i class="fas fa-eye"></i>
                                Ver
                            </button>
                        </td>
                    </tr>

                    <!-- Mensaje cuando no hay reclamos -->
                    <tr *ngIf="reclamos.length === 0" class="empty-row">
                        <td colspan="7" class="empty-cell">
                            <div class="empty-state">
                                <div class="empty-icon">üìù</div>
                                <h3>No hay reclamos</h3>
                                <p>No se encontraron reclamos con los filtros aplicados.</p>
                                <button class="btn btn-primary" (click)="limpiarFiltros()">
                                    Ver todos los reclamos
                                </button>
                            </div>
                        </td>
                    </tr>
                </tbody>
            </table>
        </div>

        <!-- Paginaci√≥n -->
        <div *ngIf="paginacion && paginacion.last_page > 1" class="paginacion">
            <button 
                class="btn btn-outline"
                [disabled]="paginacion.current_page === 1"
                (click)="cambiarPagina(paginacion.current_page - 1)"
            >
                Anterior
            </button>
            
            <div class="paginacion-numeros">
                <button 
                    *ngFor="let pagina of getPaginasVisibles()"
                    class="btn-pagina"
                    [class.activa]="pagina === paginacion.current_page"
                    [disabled]="pagina === -1"
                    (click)="cambiarPagina(pagina)"
                >
                    <span *ngIf="pagina !== -1">{{ pagina }}</span>
                    <span *ngIf="pagina === -1">...</span>
                </button>
            </div>
            
            <button 
                class="btn btn-outline"
                [disabled]="paginacion.current_page === paginacion.last_page"
                (click)="cambiarPagina(paginacion.current_page + 1)"
            >
                Siguiente
            </button>
        </div>
    </div>

    <!-- Modal de detalle -->
    <div *ngIf="mostrandoDetalle && reclamoSeleccionado" class="modal-overlay" (click)="cerrarDetalle()">
        <div class="modal-detalle" (click)="$event.stopPropagation()">
            <div class="modal-header">
                <h2>Detalle del Reclamo {{ reclamoSeleccionado.numero_reclamo }}</h2>
                <button class="btn-cerrar" (click)="cerrarDetalle()">
                    <i class="fas fa-times"></i>
                </button>
            </div>

            <div class="modal-body">
                <div class="detalle-grid">
                    <!-- Informaci√≥n del cliente -->
                    <div class="detalle-seccion">
                        <h3>Informaci√≥n del Cliente</h3>
                        <div class="detalle-campo">
                            <label>Nombre completo:</label>
                            <span>{{ getNombreCompleto(reclamoSeleccionado) }}</span>
                        </div>
                        <div class="detalle-campo">
                            <label>Documento:</label>
                            <span>{{ reclamoSeleccionado.tipo_documento | uppercase }} - {{ reclamoSeleccionado.numero_documento }}</span>
                        </div>
                        <div class="detalle-campo">
                            <label>Email:</label>
                            <span>{{ reclamoSeleccionado.email }}</span>
                        </div>
                        <div class="detalle-campo">
                            <label>Tel√©fono:</label>
                            <span>{{ reclamoSeleccionado.telefono }}</span>
                        </div>
                        <div class="detalle-campo">
                            <label>Direcci√≥n:</label>
                            <span>{{ reclamoSeleccionado.direccion }}</span>
                        </div>
                    </div>

                    <!-- Informaci√≥n del reclamo -->
                    <div class="detalle-seccion">
                        <h3>Informaci√≥n del Reclamo</h3>    
                        <div class="detalle-campo">
                            <label>Tipo:</label>
                            <span class="tipo-badge" [class]="getTipoClase(reclamoSeleccionado.tipo_reclamo)">
                                {{ reclamoSeleccionado.tipo_reclamo | titlecase }}
                            </span>
                        </div>
                        <div class="detalle-campo">
                            <label>Estado:</label>
                            <span class="estado-badge" [class]="getEstadoClase(reclamoSeleccionado.estado)">
                                {{ reclamoSeleccionado.estado | titlecase }}
                            </span>
                        </div>
                        <div class="detalle-campo">
                            <label>Fecha del incidente:</label>
                            <span>{{ reclamoSeleccionado.fecha_incidente | date:'dd/MM/yyyy' }}</span>
                        </div>
                        <div class="detalle-campo">
                            <label>Monto reclamado:</label>
                            <span *ngIf="reclamoSeleccionado.monto_reclamado">
                                {{ formatearMonto(reclamoSeleccionado.monto_reclamado) }}
                            </span>
                            <span *ngIf="!reclamoSeleccionado.monto_reclamado">No especificado</span>
                        </div>
                    </div>

                    <!-- Informaci√≥n del bien -->
                    <div class="detalle-seccion">
                        <h3>Bien o Servicio</h3>
                        <div class="detalle-campo">
                            <label>Tipo:</label>
                            <span>{{ reclamoSeleccionado.tipo_bien | titlecase }}</span>
                        </div>
                        <div class="detalle-campo descripcion-campo">
                            <label>Descripci√≥n:</label>
                            <span>{{ reclamoSeleccionado.descripcion_bien }}</span>
                        </div>
                        <div class="detalle-campo" *ngIf="reclamoSeleccionado.pedido_concreto">
                            <label>Pedido espec√≠fico:</label>
                            <span>{{ reclamoSeleccionado.pedido_concreto }}</span>
                        </div>
                    </div>

                    <!-- Detalle del reclamo -->
                    <div class="detalle-seccion detalle-completo">
                        <h3>Detalle del {{ reclamoSeleccionado.tipo_reclamo | titlecase }}</h3>
                        <div class="detalle-campo descripcion-campo">
                            <p>{{ reclamoSeleccionado.detalle_reclamo }}</p>
                        </div>
                    </div>

                    <!-- Fechas -->
                    <div class="detalle-seccion">
                        <h3>Fechas</h3>
                        <div class="detalle-campo">
                            <label>Fecha de registro:</label>
                            <span>{{ formatearFecha(reclamoSeleccionado.created_at) }}</span>
                        </div>
                        <div class="detalle-campo">
                            <label>√öltima actualizaci√≥n:</label>
                            <span>{{ formatearFecha(reclamoSeleccionado.updated_at) }}</span>
                        </div>
                    </div>
                </div>

                <!-- Acciones del modal -->
                <div class="modal-acciones">
                    <div class="estado-cambio">
                        <label>Cambiar estado:</label>
                       <select 
                        class="estado-select-modal"
                        [value]="reclamoSeleccionado.estado"
                        (change)="actualizarEstado(reclamoSeleccionado, estadoSelect.value)"
                        [disabled]="actualizandoEstado"
                        #estadoSelect
                        >
                        <option value="pendiente">Pendiente</option>
                        <option value="en_proceso">En Proceso</option>
                        <option value="resuelto">Resuelto</option>
                        </select>
                        <!-- Indicador de carga -->
                        <span *ngIf="actualizandoEstado" class="loading-text">
                            Actualizando...
                        </span>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>