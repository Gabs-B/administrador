<div class="container-fluid py-4 bg-light">
    <!-- Header -->
        <div class="d-flex justify-content-between align-items-center mb-4 pb-4 border-bottom border-2 border-primary border-opacity-25">
            <h1 class="h2 mb-1 text-dark fw-bold">
            <i class="fas fa-users text-primary"></i>
                Gestión de Clientes
            </h1>    
        </div>

    <!-- Filtros -->
    <div class="card mb-4 shadow-sm">
        <div class="card-body">
            <div class="row g-3 align-items-end">
                
                <!-- Búsqueda -->
                <div class="col-md-4">
                    <label class="form-label small fw-semibold text-dark">
                        <i class="fas fa-search text-muted me-1"></i>
                        Buscar:
                    </label>                    <input
                        type="text"
                        class="form-control"
                        placeholder="Buscar por nombre, DNI o email..."
                        [(ngModel)]="filtros.buscar"
                        (keyup.enter)="aplicarFiltros()"
                    />
                </div>

                <!-- Tipo -->
                <div class="col-md-3">
                    <label class="form-label small fw-medium">Tipo:</label>
                    <select class="form-select" [(ngModel)]="filtros.tipo">
                        <option value="todos">Todos</option>
                        <option value="registrado">Registrados</option>
                        <option value="invitado">Invitados</option>
                    </select>
                </div>

                <!-- Botones de filtro -->
                <div class="col-md-auto ms-auto">
                    <div class="d-flex gap-2">
                         <button class="btn btn-primary flex-fill flex-md-grow-0" (click)="aplicarFiltros()">
                            <i class="fas fa-filter me-1"></i>
                            Buscar
                        </button>
                        <button class="btn btn-outline-secondary flex-fill flex-md-grow-0" (click)="limpiarFiltros()">
                            <i class="fas fa-eraser me-1"></i>
                            Limpiar
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Loading -->
        <div *ngIf="cargando" class="card shadow-sm border-0">
        <div class="card-body text-center py-5">
            <div class="loading-spinner mx-auto mb-4"></div>
            <h5 class="text-primary mb-2">Cargando clientes...</h5>
            <p class="text-muted small mb-0">Esto puede tardar unos segundos</p>
        </div>
    </div>

    <!-- Error -->
   <div *ngIf="error && !cargando" class="card shadow-sm border-0 border-start border-danger border-4">
        <div class="card-body text-center py-5">
            <div class="text-danger mb-4">
                <i class="fas fa-exclamation-triangle fs-1 mb-3 d-block"></i>
                <h5>Oops! Algo salió mal</h5>
                <p class="mb-0">{{ error }}</p>
            </div>
            <button class="btn btn-primary" (click)="cargarClientes()">
                <i class="fas fa-refresh me-1"></i>
                Reintentar
            </button>
        </div>
    </div>

    <!-- Tabla de clientes -->
    <div *ngIf="!cargando && !error" class="card shadow-sm">
        
        <!-- Info de resultados -->
        <div class="card-header bg-gradient-primary text-white d-flex justify-content-between align-items-center flex-wrap gap-3 py-3">
            <div class="d-flex align-items-center gap-2">
                <i class="fas fa-chart-bar"></i>
                <span class="fw-medium">
                Mostrando {{ clientes.length }} de {{ totalClientes }} clientes
                </span>
            </div>
        </div>

        <!-- Tabla -->
    <div class="table-responsive">
            <table class="table table-hover mb-0 align-middle">
                <thead class="table-dark">
                    <tr>
                        <th scope="col" style="width: 180px;">
                            <i class="fas fa-user me-1"></i>
                            Cliente
                        </th>
                        <th scope="col" style="width: 80px;">
                            <i class="fas fa-id-card me-1"></i>
                            DNI
                        </th>
                        <th scope="col" style="width: 80px;">
                            <i class="fas fa-address-book me-1"></i>
                            Contacto
                        </th>
                        <th scope="col" style="width: 10px;" class="text-center">
                            <i class="fas fa-user-tag me-1"></i>
                            Tipo
                        </th>
                        <th scope="col" style="width: 160px;" class="text-center">
                            <i class="fas fa-calendar-alt me-1"></i>
                            Fecha de Registro
                        </th>
                    </tr>
                </thead>
                <tbody>
                    <tr *ngFor="let cliente of clientes" class="cliente-row">
                        
                        <!-- Cliente (Nombre) -->
                        <td>
                            <div>
                                <div class="fw-bold text-dark mb-1">{{ cliente.nombre }}</div>
                                <!-- Uncomment if needed: -->
                                <!-- <small class="badge bg-light text-muted" *ngIf="cliente.user_id">#{{ cliente.user_id }}</small> -->
                            </div>
                        </td>

                        <!-- DNI -->
                        <td>
                            <span class="badge bg-light text-dark border sku-badge">
                                <i class="fas fa-id-card me-1"></i>
                                {{ cliente.dni }}
                            </span>
                        </td>

                        <!-- Contacto -->
                        <td>
                            <div class="contacto-info">
                                <div class="d-flex align-items-center gap-2 mb-1" *ngIf="cliente.email">
                                    <i class="fas fa-envelope text-muted"></i>
                                    <small class="text-muted">{{ cliente.email }}</small>
                                </div>
                                <div class="d-flex align-items-center gap-2" *ngIf="cliente.telefono">
                                    <i class="fas fa-phone text-muted"></i>
                                    <small class="text-muted">{{ cliente.telefono }}</small>
                                </div>
                            </div>
                        </td>

                        <!-- Tipo -->
                        <td class="text-center">
                        <span class="badge fs-6 px-3 py-2"
                                [class]="'text-bg-' + (cliente.tipo === 'registrado' 
                                                        ? 'success' 
                                                        : cliente.tipo === 'invitado' 
                                                        ? 'warning' 
                                                        : 'secondary')"
                                [title]="cliente.tipo">
                            <i [class]="cliente.tipo === 'registrado' 
                                        ? 'fas fa-user-check' 
                                        : cliente.tipo === 'invitado' 
                                            ? 'fas fa-user-clock' 
                                            : 'fas fa-user'" 
                            class="me-1"></i>
                            {{ cliente.tipo }}
                        </span>
                        </td>



                        <!-- Fecha de registro -->
                        <td class="text-center">
                            <small class="fecha-text text-muted">
                                {{ cliente.created_at | date:'dd/MM/yyyy HH:mm' }}
                            </small>
                        </td>
                    </tr>

                    <!-- Mensaje cuando no hay clientes -->
                    <tr *ngIf="clientes.length === 0">
                        <td colspan="5" class="text-center py-5">
                            <div class="empty-state">
                                <h4 class="text-muted mb-3">No hay clientes disponibles</h4>
                                <p class="text-muted mb-4">
                                    No se encontraron clientes que coincidan con los filtros aplicados.
                                    <br>
                                    <small>Intenta ajustar tus criterios de búsqueda o crear un nuevo cliente.</small>
                                </p>
                                <div class="d-flex gap-2 justify-content-center">
                                    <button class="btn btn-outline-primary" (click)="limpiarFiltros()">
                                        <i class="fas fa-eye me-1"></i>
                                        Ver todos los clientes
                                    </button>
                                </div>
                            </div>
                        </td>
                    </tr>
                </tbody>
            </table>
        </div>

        <!-- Paginación -->
        <div *ngIf="paginacion && paginacion.last_page > 1" class="card-footer bg-light border-0">
            <nav aria-label="Paginación de clientes" class="d-flex justify-content-center">
                <ul class="pagination mb-0">
                    
                    <!-- Primera página -->
                    <li class="page-item" [class.disabled]="paginacion.current_page === 1">
                        <button class="page-link" 
                                [disabled]="paginacion.current_page === 1"
                                (click)="cambiarPagina(1)">
                            <i class="fas fa-angle-double-left"></i>
                        </button>
                    </li>

                    <!-- Anterior -->
                    <li class="page-item" [class.disabled]="paginacion.current_page === 1">
                        <button class="page-link" 
                                [disabled]="paginacion.current_page === 1"
                                (click)="cambiarPagina(paginacion.current_page - 1)">
                            <i class="fas fa-angle-left"></i>
                            Anterior
                        </button>
                    </li>
                    
                    <!-- Números de página -->
                    <ng-container *ngFor="let pagina of getPaginasVisibles()">
                        <li *ngIf="pagina !== -1" 
                            class="page-item" 
                            [class.active]="pagina === paginacion.current_page">
                            <button class="page-link fw-bold" (click)="cambiarPagina(pagina)">
                                {{ pagina }}
                            </button>
                        </li>
                        <li *ngIf="pagina === -1" class="page-item disabled">
                            <span class="page-link">...</span>
                        </li>
                    </ng-container>
                    
                    <!-- Siguiente -->
                    <li class="page-item" [class.disabled]="paginacion.current_page === paginacion.last_page">
                        <button class="page-link" 
                                [disabled]="paginacion.current_page === paginacion.last_page"
                                (click)="cambiarPagina(paginacion.current_page + 1)">
                            Siguiente
                            <i class="fas fa-angle-right"></i>
                        </button>
                    </li>
                    
                    <!-- Última página -->
                    <li class="page-item" [class.disabled]="paginacion.current_page === paginacion.last_page">
                        <button class="page-link" 
                                [disabled]="paginacion.current_page === paginacion.last_page"
                                (click)="cambiarPagina(paginacion.last_page)">
                            <i class="fas fa-angle-double-right"></i>
                        </button>
                    </li>
                </ul>
            </nav>
        </div>

    </div>
</div>