<div class="container-fluid py-4 bg-light min-vh-100">
  
  <!-- Header -->
  <div class="d-flex justify-content-between align-items-center mb-4">
    <div>
      <h1 class="h2 mb-0 text-dark fw-bold">Dashboard</h1>
    </div>
    <div>
      <button class="btn btn-primary d-flex align-items-center gap-2" 
              (click)="refreshStats()" 
              [disabled]="loading">
        <svg class="icon" [class.spinning]="loading" width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
          <path d="M17.65 6.35C16.2 4.9 14.21 4 12 4c-4.42 0-7.99 3.58-7.99 8s3.57 8 7.99 8c3.73 0 6.84-2.55 7.73-6h-2.08c-.82 2.33-3.04 4-5.65 4-3.31 0-6-2.69-6-6s2.69-6 6-6c1.66 0 3.14.69 4.22 1.78L13 11h7V4l-2.35 2.35z"/>
        </svg>
        <span>Actualizar</span>
      </button>
    </div>
  </div>

  <!-- Loading State -->
  <div *ngIf="loading" class="d-flex flex-column align-items-center justify-content-center" style="min-height: 400px;">
    <div class="loading-spinner mb-3"></div>
    <p class="text-muted">Cargando información...</p>
  </div>

  <!-- Error State -->
  <div *ngIf="error && !loading" class="d-flex justify-content-center py-4">
    <div class="card border-danger" style="max-width: 400px;">
      <div class="card-body text-center">
        <svg class="text-danger mb-3" width="48" height="48" viewBox="0 0 24 24" fill="currentColor">
          <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 15l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z"/>
        </svg>
        <h5 class="card-title text-danger">Ocurrió un error</h5>
        <p class="card-text text-muted">{{ error }}</p>
        <button class="btn btn-primary" (click)="refreshStats()">
          Reintentar
        </button>
      </div>
    </div>
  </div>

  <!-- Dashboard Content -->
  <div *ngIf="stats && !loading">
    
    <!-- KPI Cards -->
    <div class="row g-4 mb-4">
      
      <!-- Total Productos -->
      <div class="col-xl-3 col-lg-6 col-md-6">
        <div class="card kpi-card h-100 shadow-sm border-0">
          <div class="card-body d-flex align-items-center">
            <div class="kpi-icon primary me-3">
              <svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor">
                <path d="M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z"/>
              </svg>
            </div>
            <div class="flex-grow-1">
              <h3 class="h2 mb-0 fw-bold text-dark">{{ stats.productos.total }}</h3>
              <small class="text-muted fw-medium">Total Productos</small>
            </div>
          </div>
        </div>
      </div>

      <!-- Total Categorías -->
      <div class="col-xl-3 col-lg-6 col-md-6">
        <div class="card kpi-card h-100 shadow-sm border-0">
          <div class="card-body d-flex align-items-center">
            <div class="kpi-icon success me-3">
              <svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor">
                <path d="M4 8h4V4H4v4zm6 12h4v-4h-4v4zm-6 0h4v-4H4v4zm0-6h4v-4H4v4zm6 0h4v-4h-4v4zm6-10v4h4V4h-4zm-6 4h4V4h-4v4zm6 6h4v-4h-4v4zm0 6h4v-4h-4v4z"/>
              </svg>
            </div>
            <div class="flex-grow-1">
              <h3 class="h2 mb-0 fw-bold text-dark">{{ stats.categorias.total }}</h3>
              <small class="text-muted fw-medium">Total Categorías</small>
            </div>
          </div>
        </div>
      </div>

      <!-- Total Clientes -->
      <div class="col-xl-3 col-lg-6 col-md-6">
        <div class="card kpi-card h-100 shadow-sm border-0">
          <div class="card-body d-flex align-items-center">
            <div class="kpi-icon info me-3">
              <svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor">
                <path d="M16 4c0-1.11.89-2 2-2s2 .89 2 2-.89 2-2 2-2-.89-2-2zm4 18v-6h2.5l-2.54-7.63A1.5 1.5 0 0 0 18.5 8H16c-.8 0-1.54.37-2.01 1.01l-.74 1.48A2 2 0 0 0 15.13 13H16v7h4z"/>
              </svg>
            </div>
            <div class="flex-grow-1">
              <h3 class="h2 mb-0 fw-bold text-dark">{{ stats.clientes.total }}</h3>
              <small class="text-muted fw-medium">Total Clientes</small>
            </div>
          </div>
        </div>
      </div>

      <!-- Total Pedidos -->
      <div class="col-xl-3 col-lg-6 col-md-6">
        <div class="card kpi-card h-100 shadow-sm border-0">
          <div class="card-body d-flex align-items-center">
            <div class="kpi-icon warning me-3">
              <svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor">
                <path d="M19 7h-3V6a4 4 0 0 0-8 0v1H5a1 1 0 0 0-1 1v11a3 3 0 0 0 3 3h10a3 3 0 0 0 3-3V8a1 1 0 0 0-1-1zM10 6a2 2 0 0 1 4 0v1h-4V6zm8 13a1 1 0 0 1-1 1H7a1 1 0 0 1-1-1V9h2v1a1 1 0 0 0 2 0V9h4v1a1 1 0 0 0 2 0V9h2v10z"/>
              </svg>
            </div>
            <div class="flex-grow-1">
              <h3 class="h2 mb-0 fw-bold text-dark">{{ stats.pedidos.total }}</h3>
              <small class="text-muted fw-medium">Total Pedidos</small>
            </div>
          </div>
        </div>
      </div>

    </div>

    <!-- Charts Section -->
    <div class="row g-4">
      
      <!-- Productos Chart -->
      <div class="col-xl-4 col-lg-6">
        <div class="card chart-card h-100 shadow-sm border-0">
          <div class="card-header bg-white border-bottom">
            <h5 class="card-title mb-0 fw-semibold">Distribución de Productos</h5>
          </div>
          <div class="card-body d-flex flex-column align-items-center">
            <div class="pie-chart mb-4">
              <svg width="200" height="200" viewBox="0 0 200 200">
                <circle cx="100" cy="100" r="80" fill="none" stroke="#e5e7eb" stroke-width="20"/>
                <circle cx="100" cy="100" r="80" fill="none" stroke="#10b981" stroke-width="20"
                        [attr.stroke-dasharray]="(stats.productos.activos / stats.productos.total * 502.4) + ' 502.4'"
                        stroke-dashoffset="0" transform="rotate(-90 100 100)"/>
              </svg>
              <div class="chart-center-text">
                <div class="center-number">{{ stats.productos.activos }}</div>
                <div class="center-label">Activos</div>
              </div>
            </div>
            <div class="w-100">
              <div class="d-flex align-items-center mb-2">
                <div class="legend-color me-2" style="background-color: #10b981;"></div>
                <small>Activos ({{ stats.productos.activos }})</small>
              </div>
              <div class="d-flex align-items-center">
                <div class="legend-color me-2" style="background-color: #f59e0b;"></div>
                <small>Sin Stock ({{ stats.productos.sin_stock }})</small>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Pedidos Chart -->
      <div class="col-xl-4 col-lg-6">
        <div class="card chart-card h-100 shadow-sm border-0">
          <div class="card-header bg-white border-bottom">
            <h5 class="card-title mb-0 fw-semibold">Estado de Pedidos</h5>
          </div>
          <div class="card-body">
            <div class="d-flex flex-column gap-3">
              
              <div class="d-flex align-items-center gap-3">
                <small class="fw-medium text-muted" style="min-width: 80px;">Pendientes</small>
                <div class="bar-container flex-grow-1">
                  <div class="bar-fill warning" 
                       [style.width.%]="(stats.pedidos.pendientes / stats.pedidos.total) * 100">
                  </div>
                </div>
                <small class="fw-semibold text-dark" style="min-width: 40px; text-align: right;">
                  {{ stats.pedidos.pendientes }}
                </small>
              </div>
              
              <div class="d-flex align-items-center gap-3">
                <small class="fw-medium text-muted" style="min-width: 80px;">Pagados</small>
                <div class="bar-container flex-grow-1">
                  <div class="bar-fill success" 
                       [style.width.%]="(stats.pedidos.pagados / stats.pedidos.total) * 100">
                  </div>
                </div>
                <small class="fw-semibold text-dark" style="min-width: 40px; text-align: right;">
                  {{ stats.pedidos.pagados }}
                </small>
              </div>
              
              <div class="d-flex align-items-center gap-3">
                <small class="fw-medium text-muted" style="min-width: 80px;">Enviados</small>
                <div class="bar-container flex-grow-1">
                  <div class="bar-fill info" 
                       [style.width.%]="(stats.pedidos.enviados / stats.pedidos.total) * 100">
                  </div>
                </div>
                <small class="fw-semibold text-dark" style="min-width: 40px; text-align: right;">
                  {{ stats.pedidos.enviados }}
                </small>
              </div>
              
            </div>
          </div>
        </div>
      </div>

      <!-- Clientes Chart -->
      <div class="col-xl-4 col-lg-12">
        <div class="card chart-card h-100 shadow-sm border-0">
          <div class="card-header bg-white border-bottom">
            <h5 class="card-title mb-0 fw-semibold">Tipos de Clientes</h5>
          </div>
          <div class="card-body d-flex flex-column align-items-center">
            <div class="donut-chart mb-4">
              <svg width="200" height="200" viewBox="0 0 200 200">
                <circle cx="100" cy="100" r="70" fill="none" stroke="#e5e7eb" stroke-width="30"/>
                <circle cx="100" cy="100" r="70" fill="none" stroke="#8b5cf6" stroke-width="30"
                        [attr.stroke-dasharray]="(stats.clientes.registrados / stats.clientes.total * 439.8) + ' 439.8'"
                        stroke-dashoffset="0" transform="rotate(-90 100 100)"/>
                <circle cx="100" cy="100" r="70" fill="none" stroke="#06b6d4" stroke-width="30"
                        [attr.stroke-dasharray]="(stats.clientes.invitados / stats.clientes.total * 439.8) + ' 439.8'"
                        [attr.stroke-dashoffset]="-(stats.clientes.registrados / stats.clientes.total * 439.8)"
                        transform="rotate(-90 100 100)"/>
              </svg>
              <div class="donut-center">
                <div class="center-number">{{ stats.clientes.total }}</div>
                <div class="center-label">Total</div>
              </div>
            </div>
            <div class="w-100">
              <div class="d-flex align-items-center mb-2">
                <div class="legend-color me-2" style="background-color: #8b5cf6;"></div>
                <small>Registrados ({{ stats.clientes.registrados }})</small>
              </div>
              <div class="d-flex align-items-center">
                <div class="legend-color me-2" style="background-color: #06b6d4;"></div>
                <small>Invitados ({{ stats.clientes.invitados }})</small>
              </div>
            </div>
          </div>
        </div>
      </div>

    </div>  
  </div>
</div>